method = [
  [[15, 6], [15, 29], [15, 24], [12, 3], [12, 32], [12, 21], [9, 0], [9, 35], [9, 18], [44, 38], [44, 36], [44, 42], [41, 37], [41, 39], [41, 43]],
  [[6, 44], [6, 20], [6, 45], [7, 41], [7, 19], [7, 48], [8, 38], [8, 18], [8, 51], [9, 15], [9, 17], [9, 11], [16, 14], [16, 10], [16, 12]],
  [[17, 26], [17, 27], [17, 8], [14, 23], [14, 30], [14, 5], [11, 20], [11, 33], [11, 2], [51, 53], [51, 47], [51, 45], [48, 52], [48, 50], [48, 46]],
  [[0, 47], [0, 26], [0, 42], [1, 50], [1, 25], [1, 39], [2, 53], [2, 24], [2, 36], [33, 35], [33, 29], [33, 27], [34, 32], [34, 28], [34, 30]],
  [[9, 45], [9, 27], [9, 36], [10, 46], [10, 28], [10, 37], [11, 47], [11, 29], [11, 38], [6, 8], [6, 2], [6, 0], [7, 5], [7, 1], [7, 3]],
  [[15, 42], [15, 33], [15, 51], [16, 43], [16, 34], [16, 52], [17, 44], [17, 35], [17, 53], [24, 26], [24, 20], [24, 18], [25, 23], [25, 19], [25, 21]]
]

for t in range(int(input())):
  cube = []
  tmp = [[] for i in ' '*5]
  for _ in ' '*3: cube.extend(input().split())
  for _ in ' '*3:
    inp = input().split()
    for i in range(4): tmp[i].extend(inp[i*3:i*3+3])
  for _ in ' '*3: tmp[-1].extend(input().split())
  for i in [1, 4, 3, 0, 2]: cube.extend(tmp[i])

  for _ in range(int(input())):
    i = list(map(int, input().split()))
    m = method[i[0]]
    if i[1] == 1: m = m[::-1]
    for x, y in m: cube[x], cube[y] = cube[y], cube[x]

  print(f'Scenario #{t+1}:')
  for i in range(3): print('      '+' '.join(cube[i*3:i*3+3]))
  for i in range(3):
    a = i*3
    print(' '.join(cube[a+36:a+39] + cube[a+9:a+12] + cube[a+45:a+48] + cube[a+27:a+30]))
  for i in range(3): print('      ' + ' '.join(cube[i*3+18:i*3+21]))
  print()
